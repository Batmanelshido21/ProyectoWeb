/**
 * @license
 * Copyright (c) 2014, 2020, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["ojs/ojcore-base","jquery","ojs/ojthemeutils"],(function(e,t,n){"use strict";var o,i,r,a,l,s,c,u={};return e.DomUtils=u,u._HTML_START_TAG="<html>",u._HTML_END_TAG="</html>",u._LEGAL_ELEMENTS={SPAN:1,B:1,I:1,EM:1,BR:1,HR:1,LI:1,OL:1,UL:1,P:1,TT:1,BIG:1,SMALL:1,PRE:1},u._LEGAL_ATTRIBUTES={class:1,style:1},u.isHTMLContent=function(e){return 0===e.indexOf(u._HTML_START_TAG)&&e.lastIndexOf(u._HTML_END_TAG)===e.length-7},u.cleanHtml=function(e){var n=t(document.createElement("span")).get(0);return n.innerHTML=e,e&&e.indexOf("<")>=0&&u._cleanElementHtml(n),n},u._cleanElementHtml=function(e){for(var n=e.childNodes,o=n.length-1;o>=0;o--){var i=n.item(o);if(i&&1===i.nodeType)if(u._LEGAL_ELEMENTS[i.nodeName]){for(var r=i.attributes,a=r.length-1;a>=0;a--){var l=r[a];void 0!==t(i).attr(l.name)&&(u._LEGAL_ATTRIBUTES[l.name]||i.removeAttribute(l.nodeName))}u._cleanElementHtml(i)}else i&&e.removeChild(i)}},u.isAncestor=function(e,t){for(var n=t.parentNode;n;){if(n===e)return!0;n=n.parentNode}return!1},u.isAncestorOrSelf=function(e,t){return t===e||u.isAncestor(e,t)},u.addResizeListener=function(e,n,o){var i=t(e),r=i.data(u._RESIZE_TRACKER_KEY);null==r&&(r=new u._ResizeTracker(e),i.data(u._RESIZE_TRACKER_KEY,r),r.start()),r.addListener(n,o)},u.removeResizeListener=function(e,n){var o=t(e),i=o.data(u._RESIZE_TRACKER_KEY);null!=i&&(i.removeListener(n),i.isEmpty()&&(i.stop(),o.removeData(u._RESIZE_TRACKER_KEY)))},u.fixResizeListeners=function(e){t(e).find(".oj-helper-detect-expansion").parent().each((function(e,n){var o=t(n).data(u._RESIZE_TRACKER_KEY);null!=o&&o.init(!0)}))},u.isMetaKeyPressed=function(t){var n=e.AgentUtils.getAgentInfo();return e.AgentUtils.OS.MAC===n.os?t.metaKey:t.ctrlKey},u.dispatchEvent=function(e,t){var n="disabled",o=e[n];try{e[n]=!1,e.dispatchEvent(t)}finally{e[n]=o}},u._invokeAfterPaint=(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,0)}).bind(window),u._cancelInvokeAfterPaint=(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||function(e){return window.clearTimeout(e)}).bind(window),u._ResizeTracker=function(e){var n=t.Callbacks(),o=[],i=[],r=0,a=null,l=null,s=null,c=null,f=null,d=null,v=null;function h(e){var t=!1;if(null!=c.offsetParent){var n=c.offsetWidth,o=c.offsetHeight;l===n&&s===o||(r=2,L(n,o),t=!0,e&&m(!0))}return t}function m(t){var i=e.offsetWidth,r=e.offsetHeight;n.has()&&(t?(null!==a&&u._cancelInvokeAfterPaint(a),a=u._invokeAfterPaint((function(){a=null,n.fire(i,r)}))):n.fire(i,r));for(var l=0;l<o.length;l++)o[l].getCallback()(i,r)}function E(e){e.stopPropagation(),h(!0)||r>0&&null!=c.offsetParent&&(0===c.scrollLeft||0===c.scrollTop)&&(r-=1,L(l,s))}function g(){m(!1)}function L(e,t){l=e,s=t;var n=c.firstChild.style,o=1;do{n.width=e+o+"px",n.height=t+o+"px",c.scrollLeft=o,c.scrollTop=o,o+=1}while((0===c.scrollTop||0===c.scrollLeft)&&o<=5);f.scrollLeft=e,f.scrollTop=t}this.addListener=function(e,t){void 0===t||0===t?n.add(e):(o.push(new u._collapsingListenerManager(e,t)),i.push(e))},this.removeListener=function(e){var t=i.indexOf(e);t>=0?(i.splice(t,1),o.splice(t,1)[0].stop()):n.remove(e)},this.isEmpty=function(){return!n.has()&&0===i.length},this.start=function(){if(v=E.bind(this),e.attachEvent)d=g.bind(this),e.attachEvent("onresize",d);else{var t=e.childNodes[0];(c=document.createElement("div")).className="oj-helper-detect-expansion";var n=document.createElement("div");c.appendChild(n),null!=t?e.insertBefore(c,t):e.appendChild(c),c.addEventListener("scroll",v,!1),(f=document.createElement("div")).className="oj-helper-detect-contraction";var o=document.createElement("div");o.style.width="200%",o.style.height="200%",f.appendChild(o),e.insertBefore(f,c),f.addEventListener("scroll",v,!1),this.init(!1)}},this.stop=function(){null!=a&&(u._cancelInvokeAfterPaint(a),a=null),null!=c?(c.removeEventListener("scroll",v),f.removeEventListener("scroll",v),c.parentNode&&e.removeChild(c),f.parentNode&&e.removeChild(f)):e.detachEvent("onresize",d)},this.init=function(e){var t=h(e);e&&!t&&null!=c.offsetParent&&L(l,s)}},u._RESIZE_TRACKER_KEY="_ojResizeTracker",u.isValidIdentifier=function(e){return/^[A-Za-z][0-9A-Z_a-z-]*$/.test(e)},u._collapsingListenerManager=function(e,t){var n=null,o=null,i=function(){e.apply(null,n),o=null},r=function(){n=Array.prototype.slice.call(arguments),null==o&&(o=window.setTimeout(i,t))};this.getCallback=function(){return r},this.stop=function(){null!=o&&(window.clearTimeout(o),o=null)}},u.isTouchSupported=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints>0||navigator.maxTouchPoints>0},u.setInKoCleanExternal=function(e){u._koCleanNode=e},u.unwrap=function(e,t){var n=u._koCleanNode;n&&e.get(0)===n||(t?t.replaceWith(e):e.unwrap())},u.isChromeEvent=function(n){function o(e){var n=e.target,o=t(n),i=n.getBoundingClientRect(),r=u.getScrollBarWidth(),a="ltr"===u.getReadingDirection();return!(!a||"HTML"!==n.nodeName&&"visible"===o.css("overflow-x")||!(e.clientX>i.right-r))||(!a&&"HTML"===n.nodeName&&e.clientX>i.left-r||(!a&&"visible"!==o.css("overflow-x")&&e.clientX<i.left+r||("HTML"===n.nodeName||"visible"!==o.css("overflow-y"))&&e.clientY>i.bottom-r))}if(!("clientX"in n)||!("clientY"in n))return!1;var i=e.AgentUtils.getAgentInfo();return e.AgentUtils.OS.ANDROID!==i.os&&e.AgentUtils.OS.IOS!==i.os&&(e.AgentUtils.ENGINE.GECKO===i.engine?function(e){try{return!e.originalTarget.localName}catch(e){return!0}}(n):e.AgentUtils.ENGINE.WEBKIT===i.engine||e.AgentUtils.ENGINE.BLINK===i.engine?o(n):e.AgentUtils.BROWSER.IE===i.browser&&o(n))},u.getScrollBarWidth=function(){var e=u._scrollBarWidth;if(t.isNumeric(e))return e;var n=t("<div></div>");t(document.body).append(n),n.width(50).height(50).css({overflow:"scroll",visibility:"hidden",position:"absolute"});var o=t("<div></div>");o.height(1),n.append(o);var i=o.width(),r=n.width();return n.remove(),e=r-i,u._scrollBarWidth=e,e},u.getReadingDirection=function(){var e=document.documentElement.getAttribute("dir");return e&&(e=e.toLowerCase()),"rtl"===e?"rtl":"ltr"},u.getScrollLeft=function(e){return Math.abs(e.scrollLeft)},u.setScrollLeft=function(t,n){if("rtl"===u.getReadingDirection()){var o=e.AgentUtils.getAgentInfo().browser;o===e.AgentUtils.BROWSER.IE||o===e.AgentUtils.BROWSER.EDGE?t.scrollLeft=n:t.scrollLeft=-n}else t.scrollLeft=n},u.getCSSLengthAsInt=function(e){if(!isNaN(e))return parseInt(e,10);if(e&&e.length>0&&"auto"!==e){var t=parseInt(e,10);return isNaN(t)&&(t=0),t}return 0},u.getCSSLengthAsFloat=function(e){if(!isNaN(e))return parseFloat(e);if(e&&e.length>0){var t=parseFloat(e);return isNaN(t)&&(t=0),t}return 0},u._LOGICAL_PARENT_DATA="oj-logical-parent",u.getLogicalParent=function(e){if(e)return e.data(u._LOGICAL_PARENT_DATA)},u.setLogicalParent=function(e,t){e&&(null===t?e.removeData(u._LOGICAL_PARENT_DATA):e.data(u._LOGICAL_PARENT_DATA,t))},u.isLogicalAncestorOrSelf=function(n,o){e.Assert.assertDomElement(n),e.Assert.assertDomElement(o);for(var i=o;i;){if(i===n)return!0;var r=u.getLogicalParent(t(i));i=r?r[0]:i.parentNode}return!1},u.validateURL=function(e,t){var n=t||["http:","https:"],o=document.createElement("a");o.href=e;var i=o.protocol;if(null!=i&&(i=i.toLowerCase()),n.indexOf(i)<0&&""!==i)throw new Error(i+" is not a valid URL protocol")},u._supressNativeContextMenu=function(){t(document.body).hasClass("oj-hybrid")&&document.body.addEventListener("contextmenu",(function(e){"INPUT"!==e.target.nodeName&&e.preventDefault()}),!0)},u._supressNativeContextMenu(),u.PRESS_HOLD_THRESHOLD=750,u.recentTouchEnd=function(){var e=0;function t(){e=Date.now()}return document.addEventListener("touchend",t,!0),document.addEventListener("touchcancel",t,!0),function(){return Date.now()-e<500}}(),u.recentTouchStart=(o=0,i=u.PRESS_HOLD_THRESHOLD+50,document.addEventListener("touchstart",(function(){o=Date.now()}),{passive:!0,capture:!0}),function(){return Date.now()-o<i}),u.recentPointer=(a=0,l=u.PRESS_HOLD_THRESHOLD+600,document.addEventListener("mousedown",(function(){var e=Date.now();(!r||e>a+u.PRESS_HOLD_THRESHOLD)&&(a=e,r=!1)}),!0),document.addEventListener("touchstart",(function(){a=Date.now(),r=!0}),{passive:!0,capture:!0}),document.addEventListener("mouseup",(function(){a=Date.now(),r=!1}),!0),document.addEventListener("touchend",(function(){a=Date.now(),r=!1}),!0),function(){return Date.now()-a<(r?l:600)}),u.makeFocusable=(s=0,c=(n.parseJSONFromFontFamily("oj-focus-config")||{}).focusHighlightPolicy,function(e){var n=e.element,o="ojFocusable";if(e.remove){n.removeClass("oj-focus oj-focus-highlight");var i=n.data(o);if(null==i)return;var r=".ojFocusable"+(""+i).split(",").join(" .ojFocusable");n.off(r).removeData(o)}else{var a=e.afterToggle||t.noop,l=e.applyHighlight?function(t){t.addClass("oj-focus"),function(e,t){switch(e?e():c){case"all":return!0;case"none":return!1;default:return!(u.recentPointer()||t&&t())}}(e.getFocusHighlightPolicy,e.recentPointer)&&t.addClass("oj-focus-highlight"),a("focusin")}:function(e){e.addClass("oj-focus"),a("focusin")},f=!1;(e.setupHandlers||function(i,r){var a=e.component,l=function(e){i(t(e.currentTarget)),f=!0},c=function(e){f&&(r(t(e.currentTarget)),f=!1)};if(a)a._on(n,{focusin:l,focusout:c});else{var u=s;s+=1;var d=n.data(o);n.data(o,null==d?u:d+","+u);var v={},h=".ojFocusable"+u;v["focusin"+h]=l,v["focusout"+h]=c,n.on(v)}})(l,(function(e){e.removeClass("oj-focus oj-focus-highlight"),a("focusout")}))}}),u}));